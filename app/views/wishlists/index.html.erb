<div class="container-fluid">
  <h3>Welcome <%= current_user.name %>, set your watchlist:</h3>

  <%= form_tag wishlists_path, method: :get do %>
    <div class="wishlist-search">
      <div id='button-holder'>
        <div class="inner-addon left-addon">

        </div>
        <div class="magnifier">
          <%= image_tag "search.png", alt: "Create your wishlist", width: 15 %>
          <p>
            <%= text_field_tag :query,
              params[:query],
              class: 'form-control', id: "search-field",
              placeholder: 'title, director, year, actor, genre' %>
          </p>
        </div>



      </div>
    </div>
  <% end %>

<div class="watchlist">
  <h3>Your watchlist <small><%= link_to 'Done', root_path %></small></h3>

  <% unless @wishlists.nil? %>
    <% @wishlists.each do |wishlist| %>
      <p>
        <%= wishlist.movie.id %>

        <%= wishlist.movie.trakt_payload['title'] %>

        <%= link_to 'Remove',
          wishlist,
          method: :delete,
          class: 'text-danger' %>
      </p>
    <% end %>
  <% end %>
</div>


<div class="pick-movie">
  </div>
    <h3>Pick a movie</h3>

    <% unless @movies_payload.nil? %>
      <% @movies_payload.each do |movie| %>
        <p>

          <% if current_user.wishlists.where(movie: movie).empty? %>
          <% if movie.image_url %>
            <img src="<%= movie.image_url %>" alt="" height="auto" width="50px">
          <% else %>
            <!-- <img src="" alt="" height="auto" width="50px"> -->
          <% end %>
            <%= movie.id %>

            <%= movie.trakt_payload['title'] %>

            <%= render 'link_to_create',
              text: 'yep',
              movie: movie,
              color: 'text-success' %>

            <%#= render 'link_to_create',
              text: 'nope',
              movie: movie,
              color: 'text-danger' %>

          <% else %>

            <span class="text-secondary" style="opacity: .3">
              <% next if current_user.wishlists.where(movie: movie).take.preference == 'yep' %>

              <%= movie.trakt_payload['title'] %>

              <%#= link_to 'Revert',
                Wishlist.where(movie: movie, user: current_user).take,
                method: :delete,
                class: 'text-danger' %>
            </span>
          <% end %>
        </p>
      <% end %>
    <% end %>
</div>

